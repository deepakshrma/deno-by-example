"use strict";(self.webpackChunkdeno_by_example_next=self.webpackChunkdeno_by_example_next||[]).push([[492],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=a.createContext({}),p=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(i.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,i=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(n),m=r,h=u["".concat(i,".").concat(m)]||u[m]||d[m]||s;return n?a.createElement(h,o(o({ref:t},c),{},{components:n})):a.createElement(h,o({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,o=new Array(s);o[0]=u;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var p=2;p<s;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},4832:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return i},default:function(){return m},frontMatter:function(){return l},metadata:function(){return p},toc:function(){return d}});var a=n(7462),r=n(3366),s=(n(7294),n(3905)),o=["components"],l={id:"advanced-graphql",title:"Build a GraphQL Server (From Scratch) | Deno Advanced",sidebar_label:"GraphQL Server",description:"Create a GraphQL Server using deno land(From Scratch)",keywords:["advanced","route","controller","server","graphql"],image:"https://postlight.com/wp-content/uploads/2019/10/Graphql2.png?w=1200"},i=void 0,p={unversionedId:"advanced-graphql",id:"advanced-graphql",title:"Build a GraphQL Server (From Scratch) | Deno Advanced",description:"Create a GraphQL Server using deno land(From Scratch)",source:"@site/docs/advanced_graphql.md",sourceDirName:".",slug:"/advanced-graphql",permalink:"/deno-by-example/advanced-graphql",editUrl:"https://github.com/deepakshrma/deno-by-example/edit/master/docs/advanced_graphql.md",tags:[],version:"current",frontMatter:{id:"advanced-graphql",title:"Build a GraphQL Server (From Scratch) | Deno Advanced",sidebar_label:"GraphQL Server",description:"Create a GraphQL Server using deno land(From Scratch)",keywords:["advanced","route","controller","server","graphql"],image:"https://postlight.com/wp-content/uploads/2019/10/Graphql2.png?w=1200"},sidebar:"someSidebar",previous:{title:"Run Deno Application on docker",permalink:"/deno-by-example/advanced-run-on-docker"}},c={},d=[{value:"Introduction",id:"introduction",level:2},{value:"Prerequisite",id:"prerequisite",level:2},{value:"Steps",id:"steps",level:2},{value:"1. Basic project directory setup",id:"1-basic-project-directory-setup",level:3},{value:"2. Velociraptor as script runner",id:"2-velociraptor-as-script-runner",level:3},{value:"3. Basic server using Oak",id:"3-basic-server-using-oak",level:3},{value:"4. Basic mock database",id:"4-basic-mock-database",level:3},{value:"5. Create a /graphql endpoint to handle graphql POST request",id:"5-create-a-graphql-endpoint-to-handle-graphql-post-request",level:3},{value:"6. Create GraphQL schema and resolver",id:"6-create-graphql-schema-and-resolver",level:3},{value:"7. Route to handle Query and execute",id:"7-route-to-handle-query-and-execute",level:3},{value:"Limitations",id:"limitations",level:2},{value:"Source Code",id:"source-code",level:2}],u={toc:d};function m(e){var t=e.components,n=(0,r.Z)(e,o);return(0,s.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h2",{id:"introduction"},"Introduction"),(0,s.kt)("p",null,"GraphQL is already known for its good things. GraphQL helps to build super scalable APIs. It reduces coupling between code and data provider. Deno is one of the fastest-growing frameworks/languages to build APIs. However, Deno community still new. So there is a very little framework in the Deno community. Some of them are in a very early stage of development."),(0,s.kt)("p",null,"In this article, I will explain how you can easily integrate the GraphQL nodejs module with Deno lang. This is a very basic implementation. However, Still, there is a lot of scope for improvements. This is not the end. This is just beginning."),(0,s.kt)("h2",{id:"prerequisite"},"Prerequisite"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Deno ",(0,s.kt)("a",{parentName:"li",href:"https://deno.land/#installation"},"installed")," on system"),(0,s.kt)("li",{parentName:"ul"},"Basic knowledge of Deno ",(0,s.kt)("a",{parentName:"li",href:"https://decipher.dev/deno-by-example/01-hello-world"},"read more..")),(0,s.kt)("li",{parentName:"ul"},"Basic understanding of routing ",(0,s.kt)("a",{parentName:"li",href:"https://decipher.dev/deno-by-example/advanced-routing"},"read more..")),(0,s.kt)("li",{parentName:"ul"},"Basic knowledge of GraphQL ",(0,s.kt)("a",{parentName:"li",href:"https://deepak-v.medium.com/build-a-scalable-graphql-server-using-typescript-and-apollo-server-4c116ed1425e"},"read more.."))),(0,s.kt)("h2",{id:"steps"},"Steps"),(0,s.kt)("h3",{id:"1-basic-project-directory-setup"},"1. Basic project directory setup"),(0,s.kt)("p",null,"First, create folders and file as described below."),(0,s.kt)("p",null,(0,s.kt)("img",{parentName:"p",src:"https://raw.githubusercontent.com/deepakshrma/deno-by-example/master/static/img/deno_gql_1.png",alt:"sample 1"})),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir  src\nmkdir  src/model src/resolvers src/routes src/schema\ntouch README.md scripts.yaml src/server.ts\n\n## Optional\nmkdir .vscode\ntouch .vscode/settings.json\n")),(0,s.kt)("p",null,"Here, ",(0,s.kt)("strong",{parentName:"p"},"src")," will be the directory containing all code. ",(0,s.kt)("strong",{parentName:"p"},"model")," is to hold all the ",(0,s.kt)("em",{parentName:"p"},"database/models"),". We will create all resolvers in ",(0,s.kt)("strong",{parentName:"p"},"resolvers")," directory. Similarly, routes and schema to keep routes and schemas respectively. ",(0,s.kt)("strong",{parentName:"p"},"src/server.ts")," will be an entry for the server to start with."),(0,s.kt)("h3",{id:"2-velociraptor-as-script-runner"},"2. Velociraptor as script runner"),(0,s.kt)("p",null,"Deno does not have a task runner like ",(0,s.kt)("strong",{parentName:"p"},"npm"),". However, in Deno community, There are lots of modules we can use. I like ",(0,s.kt)("a",{parentName:"p",href:"https://deno.land/x/velociraptor@1.0.0-beta.16"},"Velociraptor"),". It is easy to start with an easy to integrate."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"## You can check the current version.\ndeno install -qA -n vr https://deno.land/x/velociraptor@1.0.0-beta.16/cli.tscl\n")),(0,s.kt)("p",null,"Once you install velociraptor using deno, It will be available as executable as ",(0,s.kt)("strong",{parentName:"p"},"vr"),". You can try to validate using ",(0,s.kt)("inlineCode",{parentName:"p"},"vr --version"),". It will print the current version of the velociraptor."),(0,s.kt)("p",null,"Let's add basic scripts in ",(0,s.kt)("strong",{parentName:"p"},"src/server.ts")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"allow:\n  - net\n  - read\n  - env\n\nscripts:\n  start:\n    cmd: deno run src/server.ts\n  test: \"echo 'No Test Found'\"\n  build: deno compile --unstable --allow-read --allow-net src/server.ts\n")),(0,s.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,s.kt)("div",{parentName:"div",className:"admonition-heading"},(0,s.kt)("h5",{parentName:"div"},(0,s.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,s.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,s.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Tips")),(0,s.kt)("div",{parentName:"div",className:"admonition-content"},(0,s.kt)("p",{parentName:"div"},(0,s.kt)("strong",{parentName:"p"},"velociraptor")," supports JSON, yaml and many more formats. I like yaml version cool so I am using it."))),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Explained:")),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("strong",{parentName:"li"},"allow")," to allow net, read, and env permission to Deno executable"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("strong",{parentName:"li"},"scripts")," to add command.")),(0,s.kt)("p",null,"Let's add basic ",(0,s.kt)("strong",{parentName:"p"},"hello world")," sever in ",(0,s.kt)("strong",{parentName:"p"},"server.ts")),(0,s.kt)("h3",{id:"3-basic-server-using-oak"},"3. Basic server using ",(0,s.kt)("a",{parentName:"h3",href:"https://oakserver.github.io/oak/"},"Oak")),(0,s.kt)("p",null,"We are going to use Oak to build our backend server. It is the most stable and community supported module out there."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="src/server.ts"',title:'"src/server.ts"'},'import { Application } from "https://deno.land/x/oak/mod.ts";\nimport { config } from "https://deno.land/x/dotenv/mod.ts";\nimport { Logger, LoggerOptions } from "https://deno.land/x/deno_util/logger.ts";\n\nconst initialOptions = { level: 0, format: "%s", newLine: true };\nconst logger = new Logger(initialOptions as LoggerOptions);\nconst { PORT = 4000 } = config({ safe: true });\n\nconst app = new Application();\napp.use((cxt) => {\n  cxt.response.body = "Hello GraphQL";\n});\n\nlogger.line(`\ud83d\ude80 Server is running on http://localhost:${PORT}/graphql`);\nawait app.listen({ port: Number(PORT) });\n')),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Run:")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"vr start\n")),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Output:")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"==========================================================\n||      \ud83d\ude80 Server is running on http://localhost:4000/graphql\n==========================================================\n")),(0,s.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,s.kt)("div",{parentName:"div",className:"admonition-heading"},(0,s.kt)("h5",{parentName:"div"},(0,s.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,s.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,s.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,s.kt)("div",{parentName:"div",className:"admonition-content"},(0,s.kt)("p",{parentName:"div"},"You may get a pop-up to allow network access to Deno when you try to run the server."))),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Explained:")),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Import oak module to create an Application."),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://deno.land/x/dotenv@v2.0.0"},"dotevn")," to allow create environmental variable."),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://deno.land/x/deno_util@v0.0.3"},"deno_util")," to create a basic logger."),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("strong",{parentName:"li"},"app.use")," to create basic route. Currently, It will respond ",(0,s.kt)("strong",{parentName:"li"},"Hello GraphQL")," to every request.")),(0,s.kt)("h3",{id:"4-basic-mock-database"},"4. Basic mock database"),(0,s.kt)("p",null,"Since the purpose of this tutorial is not to teach you how to bind database and all. So we will mock the database as close as a real app."),(0,s.kt)("p",null,"Create a ",(0,s.kt)("strong",{parentName:"p"},"database.ts")," file ",(0,s.kt)("inlineCode",{parentName:"p"},"touch src/model/database.ts")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="src/model/database.ts"',title:'"src/model/database.ts"'},'const users = [\n  {\n    _id: "6027d46771b8a91a27bc9e13",\n    index: 0,\n    guid: "b0b80419-58a5-42ac-b488-b7c87a66f9f7",\n    isActive: true,\n    balance: "$3,095.41",\n    picture: "http://placehold.it/32x32",\n    age: 26,\n    name: "Hickman Beach",\n    gender: "male",\n    email: "hickmanbeach@vidto.com",\n    phone: "+1 (980) 401-2407",\n    address: "489 Canda Avenue, Buxton, Tennessee, 252",\n    about: "lorem..",\n    registered: "2020-11-16T10:40:17 -08:00",\n    friends: [\n      {\n        id: 0,\n        name: "Franklin Gentry",\n      },\n    ],\n  },\n];\n\nexport interface Friend {\n  id: number;\n  name: string;\n}\n\nexport interface User {\n  _id: string;\n  index: number;\n  guid: string;\n  isActive: boolean;\n  balance: string;\n  picture: string;\n  age: number;\n  name: string;\n  gender: string;\n  email: string;\n  phone: string;\n  address: string;\n  about: string;\n  registered: string;\n  friends: Friend[];\n}\n\nexport const getUsers = async (predicate?: (user: User) => boolean) => {\n  if (typeof predicate === "function") return users.filter(predicate);\n  return users;\n};\n')),(0,s.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,s.kt)("div",{parentName:"div",className:"admonition-heading"},(0,s.kt)("h5",{parentName:"div"},(0,s.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,s.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,s.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,s.kt)("div",{parentName:"div",className:"admonition-content"},(0,s.kt)("p",{parentName:"div"},"You can get the whole file in ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/deepakshrma/deno-graphql-starter"},"github repo"),"."))),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Explained:")),(0,s.kt)("p",null,"A very basic mock database with ",(0,s.kt)("strong",{parentName:"p"},"getUsers")," method, which returns users based on a predicate. If there is no predicate, It will return all users else apply a filter using a predicate."),(0,s.kt)("h3",{id:"5-create-a-graphql-endpoint-to-handle-graphql-post-request"},"5. Create a /graphql endpoint to handle graphql POST request"),(0,s.kt)("p",null,"GraphQL specs support POST to query server. We will use the same. To create a scalable routing. We will create our route in the routes folder and append it in Oak Application using the callback function."),(0,s.kt)("p",null,"Create files ",(0,s.kt)("inlineCode",{parentName:"p"},"touch src/routes/index.ts src/routes/graphql.ts")),(0,s.kt)("p",null,"Let's create gqlrouter"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="src/routes/graphql.ts"',title:'"src/routes/graphql.ts"'},'import { Router } from "https://deno.land/x/oak/mod.ts";\n\nconst gqlrouter = new Router();\ngqlrouter\n  .get("/graphql", (context) => {\n    context.response.body = "Please use Post to Query";\n  })\n  .post("/graphql", async (context) => {\n    const result = context.request.body();\n    if (result.type === "json") {\n      const { query, variables = {} } = await result.value;\n      if (query) {\n        context.response.body = { query, variables };\n      } else {\n        context.response.body = { message: "Invalid Query" };\n        context.response.status = 400;\n      }\n    }\n  });\n\nexport default gqlrouter;\n')),(0,s.kt)("p",null,"Let's update ",(0,s.kt)("strong",{parentName:"p"},"index.ts")," to append routes to Server."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="src/routes/index.ts"',title:'"src/routes/index.ts"'},'import {\n  Application,\n  Middleware,\n  Router,\n} from "https://deno.land/x/oak/mod.ts";\nimport { requestTraceMiddleware } from "https://deno.land/x/oak_middlewares/mod.ts";\nimport gqlrouter from "./graphql.ts";\nconst baseRoute = new Router();\n\nbaseRoute.get("/", (context) => {\n  context.response.body = `<b>Please use <a href="/graphql">/graphql</a> to query</b>`;\n  context.response.headers.append("Content-Type", "text/html; charset=UTF-8");\n});\n\nexport default function init(app: Application) {\n  app.use(\n    requestTraceMiddleware<Middleware>({ type: "combined" })\n  );\n  app.use(baseRoute.routes());\n  app.use(gqlrouter.routes());\n  app.use(gqlrouter.allowedMethods());\n}\n')),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Explained:")),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("strong",{parentName:"li"},"graphql.ts"),', We have just created an instance of Oak route. It can accept a get request and a post request at endpoint "/graphql".'),(0,s.kt)("li",{parentName:"ul"},"All the GraphQL request contains ",(0,s.kt)("strong",{parentName:"li"},"query")," and ",(0,s.kt)("strong",{parentName:"li"},"variables")," as data payload."),(0,s.kt)("li",{parentName:"ul"},"Currently, return ",(0,s.kt)("inlineCode",{parentName:"li"},"query and variables")," in return response."),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("strong",{parentName:"li"},"index.ts")," to combine routes and apply some other middleware to Oak Application.")),(0,s.kt)("p",null,"Let's update our ",(0,s.kt)("strong",{parentName:"p"},"server.ts")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="src/server.ts"',title:'"src/server.ts"'},'/// Rest of the code...\nimport init from "./routes/index.ts";\n\nconst app = new Application();\ninit(app);\n\n/// Rest of the code...\n')),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Run:"),"\n",(0,s.kt)("inlineCode",{parentName:"p"},"vr run start")),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Query using Postman:")),(0,s.kt)("p",null,(0,s.kt)("img",{parentName:"p",src:"https://raw.githubusercontent.com/deepakshrma/deno-by-example/master/static/img/deno_gql_2.png",alt:"sample 2"})),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Query using CURL:")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'curl --location --request POST \'http://localhost:4000/graphql\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{"query":"query HelloWorld {\\n    hello {\\n        name\\n    }\\n}","variables":{"name":"Hickman"}}\'\n')),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Output:")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "query": "query HelloWorld {\\n    hello {\\n        name\\n    }\\n}",\n  "variables": {\n    "name": "Hickman"\n  }\n}\n')),(0,s.kt)("h3",{id:"6-create-graphql-schema-and-resolver"},"6. Create GraphQL schema and resolver"),(0,s.kt)("p",null,"GraphQL Executor requires schema and resolver to execute the query. For that, we need to create schema and resolver. Schema can be written in String and compile to code using ",(0,s.kt)("strong",{parentName:"p"},"buildSchema")," helper method. Resolvers are basic functions, will be called by graphql executor, and act on the query."),(0,s.kt)("p",null,"To use GraphQL Executor we have to install/use ",(0,s.kt)("a",{parentName:"p",href:"https://cdn.skypack.dev/graphql"},"graphql module")," from ",(0,s.kt)("a",{parentName:"p",href:"https://cdn.skypack.dev/graphql"},"cdn.skypack.dev")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="src/schema/user.ts"',title:'"src/schema/user.ts"'},"const UserSchema = `\n  type Friends {\n    id: Int\n    name: String\n  }\n\n  type User {\n    _id: String\n    index: Int\n    guid: String\n    isActive: Boolean\n    balance: String\n    picture: String\n    age: Int\n    name: String\n    gender: String\n    email: String\n    phone: String\n    address: String\n    about: String\n    registered: String\n    friends: [Friends]\n  }\n`;\nexport default UserSchema;\n")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="src/schema/index.ts"',title:'"src/schema/index.ts"'},'import { buildSchema } from "https://cdn.skypack.dev/graphql";\nimport UserSchema from "./user.ts";\nconst base = `\ntype Query {\n  hello: String\n  users(name: String): [User]\n}\n`;\nexport default buildSchema([base, UserSchema].join("\\n"), {});\n')),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Explained:")),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"You can use ",(0,s.kt)("a",{parentName:"li",href:"https://transform.tools/json-to-graphql"},"json-to-graphql"),", To generate graphql schema"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://graphql.org/graphql-js/"},"buildSchema")," compile and validate schema to generate code in runtime.")),(0,s.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,s.kt)("div",{parentName:"div",className:"admonition-heading"},(0,s.kt)("h5",{parentName:"div"},(0,s.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,s.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,s.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,s.kt)("div",{parentName:"div",className:"admonition-content"},(0,s.kt)("p",{parentName:"div"},"Currently, graphql does not support multi-file schema(Query). So we have to write all queries in ",(0,s.kt)("strong",{parentName:"p"},"index.ts"),". Hopefully, In future, we can use ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/ardatan/graphql-tools"},"graphql tools"),"."))),(0,s.kt)("p",null,"Let's create resolvers for ",(0,s.kt)("strong",{parentName:"p"},"users")," and ",(0,s.kt)("strong",{parentName:"p"},"hello")," query"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="src/resolvers/hello_world.ts"',title:'"src/resolvers/hello_world.ts"'},'const HelloResolver = {\n  Query: {\n    hello: async (_: any, { name }: any = {}, context: any, z: any) => {\n      return "Hello world!";\n    },\n  },\n};\nexport default HelloResolver;\n')),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="src/resolvers/user.ts"',title:'"src/resolvers/user.ts"'},'import { getUsers } from "../model/database.ts";\n\nconst UserResolver = {\n  Query: {\n    users: async (d: any = {}, context: any) => {\n      return getUsers(d.name ? (u: any) => u.name.includes(d.name) : undefined);\n    },\n  },\n};\nexport default UserResolver;\n')),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="src/resolvers/index.ts"',title:'"src/resolvers/index.ts"'},'import HelloResolver from "./hello_world.ts";\nimport UserResolver from "./user.ts";\n\nconst resolvers = Object.assign(\n  {},\n  ...[HelloResolver, UserResolver].map((x) => x.Query)\n);\nexport default resolvers;\n')),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Explained:")),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("strong",{parentName:"li"},"user.ts")," and ",(0,s.kt)("strong",{parentName:"li"},"hello.ts")," contains an object with Query in it. The query has the function same name as it is defined in GraphQL Schema."),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("strong",{parentName:"li"},"index.ts")," accumulate all the resolvers.")),(0,s.kt)("h3",{id:"7-route-to-handle-query-and-execute"},"7. Route to handle Query and execute"),(0,s.kt)("p",null,"Now we have created schema and resolver function. We can handle GraphQL requests and responses to the query. For that, we need to update our ",(0,s.kt)("strong",{parentName:"p"},"src/routes/graphql.ts"),"."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="src/routes/graphql.ts"  {4,5,15-32}',title:'"src/routes/graphql.ts"',"":!0,"{4,5,15-32}":!0},'import { Router } from "https://deno.land/x/oak/mod.ts";\nimport { graphql } from "https://cdn.skypack.dev/graphql";\nimport schema from "../schema/index.ts";\nimport resolvers from "../resolvers/index.ts";\n\nconst gqlrouter = new Router();\ngqlrouter\n  .get("/graphql", (context) => {\n    context.response.body = "Please use Post to Query";\n  })\n  .post("/graphql", async (context) => {\n    const result = context.request.body();\n    if (result.type === "json") {\n      const { query, variables = {} } = await result.value;\n      if (query) {\n        const data = await (graphql as any)(\n          schema,\n          query,\n          resolvers,\n          {\n            request: context.request,\n            response: context.response,\n          },\n          variables || {}\n        );\n        if (data.errors) {\n          context.response.body = data;\n          context.response.status = 400;\n        } else {\n          context.response.body = data;\n        }\n      } else {\n        context.response.body = { message: "Invalid Query" };\n        context.response.status = 400;\n      }\n    }\n  });\n\nexport default gqlrouter;\n')),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Query using Postman:")),(0,s.kt)("p",null,(0,s.kt)("img",{parentName:"p",src:"https://raw.githubusercontent.com/deepakshrma/deno-by-example/master/static/img/deno_gql_3.png",alt:"sample 2"})),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Query using CURL:")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'curl --location --request POST \'http://localhost:4000/graphql\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{"query":"query User($name: String){\\n    users(name: $name) {\\n        name\\n        age\\n    }\\n}","variables":{"name":"Hickman"}}\'\n')),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Output:")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "users": [\n      {\n        "name": "Hickman Beach",\n        "age": 26\n      }\n    ]\n  }\n}\n')),(0,s.kt)("p",null,"Congrats, Your GraphQL Server is ready to serve(\ud83d\ude80) the request."),(0,s.kt)("h2",{id:"limitations"},"Limitations"),(0,s.kt)("p",null,"As I mentioned earlier, Deno is still very new and the community is also very new. The above app has a lot of limitations. However, We shouldn't stop exploring it. Some of the limitations are highlighted below."),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Support for ",(0,s.kt)("a",{parentName:"li",href:"https://graphql.org/learn/queries/#aliases"},"multiple Query/Aliases")),(0,s.kt)("li",{parentName:"ul"},"Merge Schema from multiple files"),(0,s.kt)("li",{parentName:"ul"},"Conflict in resolvers"),(0,s.kt)("li",{parentName:"ul"},"Validations and Proper Error Handling")),(0,s.kt)("h2",{id:"source-code"},"Source Code"),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://github.com/deepakshrma/deno-graphql-starter"},"deno-graphql-starter")),(0,s.kt)("p",null,(0,s.kt)("em",{parentName:"p"},"I hope you like this tutorial. let me know your feedback in the comment. Please support(\ud83d\ude4f\ud83d\ude4f) by subscribing and clapping on ",(0,s.kt)("a",{parentName:"em",href:"https://deepak-v.medium.com/"},"https://deepak-v.medium.com/"),".")))}m.isMDXComponent=!0}}]);