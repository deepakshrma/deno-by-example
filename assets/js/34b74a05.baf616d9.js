"use strict";(self.webpackChunkdeno_by_example_next=self.webpackChunkdeno_by_example_next||[]).push([[756],{1164:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>p,frontMatter:()=>t,metadata:()=>l,toc:()=>d});var s=o(7624),r=o(2172);const t={id:"advanced-run-on-docker",title:"Run Deno Application on docker | Continuous Integration and Deployment",sidebar_label:"Run Deno Application on docker",description:"Run Deno Application on docker | Continuous Integration and Deployment",keywords:["advanced","docker","data","cicd","tools","devops"],image:"https://source.unsplash.com/qX2ENCIxquA/800x450"},i=void 0,l={id:"advanced-run-on-docker",title:"Run Deno Application on docker | Continuous Integration and Deployment",description:"Run Deno Application on docker | Continuous Integration and Deployment",source:"@site/docs/advanced_run_on_docker.md",sourceDirName:".",slug:"/advanced-run-on-docker",permalink:"/deno-by-example/advanced-run-on-docker",draft:!1,unlisted:!1,editUrl:"https://github.com/deepakshrma/deno-by-example/edit/master/docs/advanced_run_on_docker.md",tags:[],version:"current",frontMatter:{id:"advanced-run-on-docker",title:"Run Deno Application on docker | Continuous Integration and Deployment",sidebar_label:"Run Deno Application on docker",description:"Run Deno Application on docker | Continuous Integration and Deployment",keywords:["advanced","docker","data","cicd","tools","devops"],image:"https://source.unsplash.com/qX2ENCIxquA/800x450"},sidebar:"someSidebar",previous:{title:"Implementing Logger",permalink:"/deno-by-example/advanced-logger"},next:{title:"GraphQL Server",permalink:"/deno-by-example/advanced-graphql"}},a={},d=[{value:"Overview",id:"overview",level:2},{value:"1. Create a simple Deno WebApp",id:"1-create-a-simple-deno-webapp",level:2},{value:"2. Create a <code>Dockerfile</code>",id:"2-create-a-dockerfile",level:2},{value:"3. Install Deno Using docker",id:"3-install-deno-using-docker",level:2},{value:"4. Running Todo App",id:"4-running-todo-app",level:2},{value:"Bonus",id:"bonus",level:2},{value:"Some Usefull Docker Commands",id:"some-usefull-docker-commands",level:2}];function c(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h2:"h2",img:"img",p:"p",pre:"pre",strong:"strong",...(0,r.M)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"Before starting code, Lets understand the concept of CICD in brief. This will give us motive to read this blog further."}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"By- ThoughtWorks\u2019 definition for CI"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"Continuous Integration (CI) is a development practice that requires developers to integrate code\ninto a shared repository several times a day. Each check-in is then\nverified by an automated build, allowing teams to detect problems early.\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Read more:"})," ",(0,s.jsx)(n.a,{href:"https://www.thoughtworks.com/es/continuous-integration",children:"https://www.thoughtworks.com/es/continuous-integration"})]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"By- Jez Humble\u2019s site"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"Continuous Delivery is the ability to get changes of all types\u2014including new features,\nconfiguration changes, bug fixes and experiments\u2014into production, or into\nthe hands of users, safely and quickly in a sustainable way.\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Read more:"})," ",(0,s.jsx)(n.a,{href:"https://continuousdelivery.com/",children:"https://continuousdelivery.com/"})]}),"\n",(0,s.jsxs)(n.p,{children:["As we can see, There are many reason why we should follow the ",(0,s.jsx)(n.strong,{children:"CICD"})," in our project development cycle. The one of reason why i follow CICD in daily work. Its ",(0,s.jsx)(n.strong,{children:"ease"})," my work and I get a ",(0,s.jsx)(n.strong,{children:"consistant environment"})," for my development work. So that i can focus on more good things rather than ",(0,s.jsx)(n.em,{children:"debuging"})," Binary ",(0,s.jsx)(n.strong,{children:"breaking issue"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["If you want to read more on CICD, You can read this ",(0,s.jsx)(n.a,{href:"https://stackify.com/what-is-cicd-whats-important-and-how-to-get-it-right/",children:"article"}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://source.unsplash.com/qX2ENCIxquA/800x450",alt:"p"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"In this tutorial, I will mainly focus on how you can setup Simple Deno Web Application just using some docker commands. In next tuitor, I will explain how to setup a FullStack Deno Application."})}),"\n",(0,s.jsx)(n.h2,{id:"1-create-a-simple-deno-webapp",children:"1. Create a simple Deno WebApp"}),"\n",(0,s.jsxs)(n.p,{children:["To show working example, We need to create a sample Application. Since the focus of this tutorial is not to create WebApp. I will recoomend you to checkout my tutorial ",(0,s.jsx)(n.a,{href:"/deno-by-example/advanced-react-ssr",children:"here"})," or ",(0,s.jsx)(n.a,{href:"https://deepak-v.medium.com//build-an-isomorphic-application-using-deno-and-react-without-webpack-deno-by-example-6c748abb3243?source=friends_link&sk=335ff7c133a790bb977d0077a322f3cd",children:"medium"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["The given app is a SSR app, has only some basic functionality. You can checkout source in ",(0,s.jsx)(n.a,{href:"https://github.com/deepakshrma/deno-by-example/tree/master/examples/ssr",children:"/examples/ssr"})," folder. Once you run app, Open ",(0,s.jsx)(n.a,{href:"http://localhost:8000/",children:"http://localhost:8000/"})," on browser. You will see Web as given below."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://raw.githubusercontent.com/deepakshrma/deno-by-example/master/static/img/todo_demo.gif",alt:"todo gif"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cd examples/ssr\n\ndeno run --allow-net --allow-read --unstable server.tsx -c tsconfig.json\n"})}),"\n",(0,s.jsxs)(n.h2,{id:"2-create-a-dockerfile",children:["2. Create a ",(0,s.jsx)(n.code,{children:"Dockerfile"})]}),"\n",(0,s.jsx)(n.p,{children:"App looks good! Let's now create a Dockerfile to startwith."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"md docker-app && touch Dockerfile\n"})}),"\n",(0,s.jsxs)(n.p,{children:["To test our docker is working fine, Let's add some ",(0,s.jsx)(n.strong,{children:"Hello World"})," program."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-docker",metastring:'title="Dockerfile"',children:'FROM alpine\n\nRUN echo "Hello Stanger!"\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Build and Run:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker build -t chucknorris .\ndocker run -it chucknorris\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Explaination:"})," Here in above ",(0,s.jsx)(n.em,{children:"Dockerfile"}),", First We are pulling the lightest linux base OS. Once pull done, We are trying to Run ",(0,s.jsx)(n.em,{children:"echo command"}),". If all good, you will see below output."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:" ---\x3e Running in 5215187d3d6a\nHello Stanger!\nRemoving intermediate container 5215187d3d6a\n"})}),"\n",(0,s.jsx)(n.p,{children:"The above output tell us, things are OK."}),"\n",(0,s.jsx)(n.h2,{id:"3-install-deno-using-docker",children:"3. Install Deno Using docker"}),"\n",(0,s.jsxs)(n.p,{children:["By default, Alpine image does not have any external software. This is the one of the thinest Linux client. To install Deno, We need to curl Deno binary. You can read all the details on ",(0,s.jsx)(n.a,{href:"https://deno.land/#installation",children:"Deno WebSite"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Let's add ",(0,s.jsx)(n.em,{children:"curl"})," using Dockerfile."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-docker",metastring:'title="Dockerfile" {3-5}',children:'FROM alpine\n\nRUN apk update && apk add curl\nENTRYPOINT ["curl"]\nCMD [ "curl", "https://api.chucknorris.io/jokes/random" ]\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Build and Run:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker build -t chucknorris .\ndocker run -it chucknorris\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Once you run you will see output along with ",(0,s.jsx)(n.em,{children:"chucknorris"})," joke. I got mine joke as ",(0,s.jsx)(n.em,{children:"\"Chuck Norris once threw a 'block party'. The city of Detroit filed for bankruptcy the next day\""}),". If your are lucky, You may get more funnier joke."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Download Deno Binary:"}),"\nNow time to ",(0,s.jsx)(n.em,{children:"install/download"})," ",(0,s.jsx)(n.strong,{children:"pre-compile"})," version of Deno binary"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-docker",metastring:'title="Dockerfile" {5}',children:'FROM alpine\n\nRUN apk update && apk add curl\n\nRUN curl -fsSL https://deno.land/x/install/install.sh | sh && mv /root/.deno/bin/deno /bin/deno\n\nENTRYPOINT ["dono"]\n\nCMD ["run", "--allow-net", "https://deno.land/std/examples/welcome.ts"]\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Build and Run:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker build -t deno-app .\ndocker run -it deno-app\n"})}),"\n",(0,s.jsx)(n.admonition,{title:"Issue",type:"caution",children:(0,s.jsxs)(n.p,{children:["There are some compiled libraries missing on ",(0,s.jsx)(n.strong,{children:"Alpine image"}),". So when you try to run Deno you may can see error like ",(0,s.jsx)(n.strong,{children:"standard_init_linux.go:211: exec user process caused"}),". To fix above error, We will you modified version of Alpine Image."]})}),"\n",(0,s.jsx)(n.p,{children:"Let's update our docker file."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-docker",metastring:'title="Dockerfile" {1}',children:'FROM frolvlad/alpine-glibc:alpine-3.11_glibc-2.31\n\nRUN apk update && apk add curl\n\nRUN curl -fsSL https://deno.land/x/install/install.sh | sh && mv /root/.deno/bin/deno /bin/deno\n\nENTRYPOINT ["deno"]\n\nCMD ["run", "--allow-net", "https://deno.land/std/examples/welcome.ts"]\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Explaination:"})," Once we pulled the image, We used curl to get the ",(0,s.jsx)(n.em,{children:"installation script"})," from Deno website and download ",(0,s.jsx)(n.em,{children:"Deno binary"}),". Since default path of deno binary is not ",(0,s.jsx)(n.em,{children:"bin"}),". So we need to copy binary to bin. You can find better way to setup path.\n",(0,s.jsx)(n.em,{children:"ENTRYPOINT"})," is to tell docker what command to use when we run docker run command. ",(0,s.jsx)(n.em,{children:"CMD"})," is the command to run."]}),"\n",(0,s.jsx)(n.p,{children:"If all OK, you will see bellow output."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"\u276f docker run -it deno-app\nDownload https://deno.land/std/examples/welcome.ts\nWarning Implicitly using latest version (0.64.0) for https://deno.land/std/examples/welcome.ts\nDownload https://deno.land/std@0.64.0/examples/welcome.ts\nCheck https://deno.land/std@0.64.0/examples/welcome.ts\n\nWelcome to Deno \ud83e\udd95\n"})}),"\n",(0,s.jsx)(n.h2,{id:"4-running-todo-app",children:"4. Running Todo App"}),"\n",(0,s.jsxs)(n.p,{children:["We have completed our 90% job. Let's run our ",(0,s.jsx)(n.em,{children:"todo-app"}),". For that, we need to copy all the required files to the docker image. We can do either using ",(0,s.jsx)(n.em,{children:"COPY"})," command or mount volume. I will show both way of doing it. However, recoomended is to use ",(0,s.jsx)(n.code,{children:"COPY"}),". This is to decouple your sytem from Docker."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Using COPY:"})}),"\n",(0,s.jsx)(n.admonition,{title:"Forbidden path outside the build context",type:"info",children:(0,s.jsxs)(n.p,{children:["Since docker does not allow file to be coppied from out of the foder. We have to copy files from ",(0,s.jsx)(n.a,{href:"https://github.com/deepakshrma/deno-by-example/tree/master/examples/ssr/",children:"/examples/ssr"})," folder to ",(0,s.jsx)(n.a,{href:"https://github.com/deepakshrma/deno-by-example/tree/master/examples/docker-app",children:"examples/docker-app"}),"."]})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:"{3}",children:"pwd\n#something/examples/docker-app\ncp -r ../ssr ./ssr\n"})}),"\n",(0,s.jsx)(n.p,{children:"Update Dockerfile to copy files."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-docker",metastring:'title="Dockerfile" {6,7}',children:'FROM frolvlad/alpine-glibc:alpine-3.11_glibc-2.31\nRUN apk update && apk add curl\nRUN curl -fsSL https://deno.land/x/install/install.sh | sh && mv /root/.deno/bin/deno /bin/deno\nWORKDIR /app\nCOPY ssr/ /app/\nENTRYPOINT ["deno"]\nCMD ["run", "--allow-net", "--allow-read", "--unstable", "server.tsx", "-c", "tsconfig.json"]\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Build and Run:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:"{2,9}",children:"docker build -t deno-app .\ndocker run -d deno-app\n\n## output\n# f75f6e55675b1f8558fcfe2c34cd25f366aacc4b0f6b5df7d7982bf3cea3c46d\n\n## Note down the output of last command\n\ndocker logs f75f6e55675b\n\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["If you notice, for first time we have run docker in ",(0,s.jsx)(n.strong,{children:"detteched"})," mode ie. ",(0,s.jsx)(n.code,{children:"docker run -d"}),". Since we are running a ",(0,s.jsx)(n.strong,{children:"long running server"}),", We should dettached the Docket image from our sytem."]})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Explaination:"})," Since we are running docker container in detteched mode. We have to grab ",(0,s.jsx)(n.strong,{children:"container-id"})," to see logs of the last docker run."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker ps | grep todo-app\n\ndocker logs f75f6e55675b\n"})}),"\n",(0,s.jsxs)(n.p,{children:["You can see output like ",(0,s.jsxs)(n.em,{children:["server is running on ",(0,s.jsx)(n.a,{href:"http://localhost:8000/",children:"http://localhost:8000/"})]}),". However, when you try to access ",(0,s.jsx)(n.a,{href:"http://localhost:8000/",children:"http://localhost:8000/"})," on browser. You cant access it. This is becuase docker runs container in ",(0,s.jsx)(n.em,{children:"isolation"}),". It does not ",(0,s.jsx)(n.em,{children:"implecite"})," expose ports out of the container. To do so, We have to ",(0,s.jsx)(n.em,{children:"expose port"})," in docker file and same time need ",(0,s.jsx)(n.em,{children:"bind to"})," external port while running command."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-docker",metastring:'title="Dockerfile" {3-5}',children:"## rest of the command\n\nWORKDIR /app\nEXPOSE 8080\nCOPY ssr/ /app/\n\n## rest of the command\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Build and run with port binding:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker build -t deno-app .\ndocker run -d -p8000:8000 deno-app\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Open ",(0,s.jsx)(n.a,{href:"http://localhost:8000/",children:"http://localhost:8000/"})," in browser, You can see running todo app."]}),"\n",(0,s.jsx)(n.h2,{id:"bonus",children:"Bonus"}),"\n",(0,s.jsx)(n.p,{children:"I told you, That you can run file without COPY command using valume mount. For that lets remove COPY commad from Dockerfile."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-docker",metastring:'title="Dockerfile" {3-5}',children:'FROM frolvlad/alpine-glibc:alpine-3.11_glibc-2.31\nRUN apk update && apk add curl\nRUN curl -fsSL https://deno.land/x/install/install.sh | sh && mv /root/.deno/bin/deno /bin/deno\nWORKDIR /app\nEXPOSE 8080\nENTRYPOINT ["deno"]\nCMD ["run", "--allow-net", "--allow-read", "--unstable", "server.tsx", "-c", "tsconfig.json"]\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker build -t deno-app .\ndocker run -d -p8000:8000 -v ${PWD}/ssr:/app  deno-app\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Hope you like this tutorial. Please follow me and clap for me on medium:"})," ",(0,s.jsx)(n.a,{href:"https://deepak-v.medium.com//",children:"https://deepak-v.medium.com/"})]}),"\n",(0,s.jsx)(n.h2,{id:"some-usefull-docker-commands",children:"Some Usefull Docker Commands"}),"\n",(0,s.jsxs)(n.admonition,{title:"Docker",type:"tip",children:[(0,s.jsxs)(n.p,{children:["Docker Images: ",(0,s.jsx)(n.code,{children:"docker images ls"})]}),(0,s.jsxs)(n.p,{children:["Running Process: ",(0,s.jsx)(n.code,{children:"docker ps"})]}),(0,s.jsxs)(n.p,{children:["Stop container: ",(0,s.jsx)(n.code,{children:"docker stop container-id"})]}),(0,s.jsxs)(n.p,{children:["Stop all container time before: ",(0,s.jsx)(n.code,{children:"docker ps | grep \" minutes ago\" | awk '{print $1}' | xargs docker stop"})]}),(0,s.jsxs)(n.p,{children:["Remove images: ",(0,s.jsx)(n.code,{children:"docker rmi -f id1 id2 id3"})]}),(0,s.jsxs)(n.p,{children:["Logs: ",(0,s.jsx)(n.code,{children:"docker logs f75f6e55675b"})]})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Source:"})}),"\n",(0,s.jsxs)(n.p,{children:["You can get all source code on GitHub.\n",(0,s.jsx)(n.a,{href:"https://github.com/deepakshrma/deno-by-example/tree/master/examples/docker-app",children:"examples/docker-app"})]})]})}function p(e={}){const{wrapper:n}={...(0,r.M)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},2172:(e,n,o)=>{o.d(n,{I:()=>l,M:()=>i});var s=o(1504);const r={},t=s.createContext(r);function i(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);